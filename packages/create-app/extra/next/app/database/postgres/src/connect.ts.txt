
import { Pool } from "pg";

if (!process.env.DATABASE_URL) {
  throw new Error("Please define the DATABASE_URL environment variable in .env.local");
}

declare global {
  // eslint-disable-next-line no-var
  var _pgPool: Pool | undefined;
}

// Create a new pool or reuse existing one in development
const pool =
  process.env.NODE_ENV === "development"
    ? global._pgPool || (global._pgPool = new Pool({ connectionString: process.env.DATABASE_URL }))
    : new Pool({ connectionString: process.env.DATABASE_URL });

export async function query(text: string, params?: any[]) {
  const res = await pool.query(text, params);
  return res;
}
